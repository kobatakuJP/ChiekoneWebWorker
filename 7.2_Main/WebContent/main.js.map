{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/calc.ts","webpack:///./src/main.ts","webpack:///./src/utils.ts"],"names":[],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/main.ts\");\n","import { Utils as U } from \"./utils\";\r\n\r\nexport interface CalcArg {\r\n    csv: string,\r\n    targetCellNum: number,\r\n    noData: NoDataTreat\r\n}\r\n\r\nexport interface WorkArg {\r\n    str: string;\r\n    targetCellNum: number;\r\n    noData: NoDataTreat;\r\n}\r\n\r\n/** データがない場合の扱い */\r\nexport enum NoDataTreat {\r\n    /** ないものとして計算する */\r\n    ignore,\r\n    /** ゼロとして計算する */\r\n    zero\r\n}\r\n\r\n/** 計算結果 */\r\nexport interface CalcResult {\r\n    val: number;\r\n    lineNum: number;\r\n    noDataNum: number;\r\n    invalidDataNum: number;\r\n}\r\n\r\nexport class CsvCalc {\r\n    /** workerプール */\r\n    workerPool: Worker[];\r\n    /** wi */\r\n    workerIndex: number;\r\n    /** 入力元CSV */\r\n    csv: string;\r\n    /** データなしの場合の扱い規定 */\r\n    noData: NoDataTreat;\r\n    /** 同時実行ワーカ数 */\r\n    workNum: number;\r\n    static LINE_SEPARATOR: string = \"\\n\";\r\n    constructor(csv: string, noData: NoDataTreat, threadNum: number) {\r\n        this.csv = csv;\r\n        this.noData = noData;\r\n        this.workNum = threadNum;\r\n        this.initWorker();\r\n        this.workerIndex = 0;\r\n    }\r\n\r\n    /** \r\n     * 平均値を含む結果を返す。  \r\n     */\r\n    async getAve(cellNum: number): Promise<CalcResult> {\r\n        const promiz = this.separateAndAssignWork(cellNum);\r\n        const vals = await Promise.all(promiz);\r\n        return U.margeAve(vals, this.noData);\r\n    }\r\n\r\n    /** csvをざっと切ってワーカに渡す、を繰り返す。 */\r\n    private separateAndAssignWork(cellNum: number): Promise<CalcResult>[] {\r\n        let result: Promise<CalcResult>[] = [];\r\n        const length = this.csv.length;\r\n        /** 均等割りした場合の数。これをもとにざっくり仕事を切っていく */\r\n        const aboutSepIndex = Math.ceil(length / this.workNum);\r\n        let startI = 0;\r\n        for (let i = aboutSepIndex; i < length; i++) {\r\n            if (this.csv[i] === CsvCalc.LINE_SEPARATOR || i === length - 1/*最後が改行じゃないかもしれないし・・・*/) {\r\n                // とりあえず次の改行までを仕事範囲とする。\r\n                result.push(this.doWorker(startI, i, cellNum));\r\n                startI = i + 1; // 次のスタートはこの改行の次の文字から\r\n                i = i + aboutSepIndex - 1; // 次の終わりはざっと飛んだあたり、ざっと飛ぶのではあるのだけど一応for文の+1を考慮して-1するような繊細な面も持ち合わせる。\r\n                if (i > length) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        // 最後の一回はほとんどの場合半端になるはずなので、ここで実行。\r\n        result.push(this.doWorker(startI, length - 1, cellNum))\r\n        return result;\r\n    }\r\n\r\n    private doWorker(s: number, e: number, cellNum: number): Promise<CalcResult> {\r\n        // TypedArray.prototype.sliceは結局コピーなのでもったいない。開始終了だけ渡す。\r\n        return new Promise((resolve, reject) => {\r\n            const arg: WorkArg = {\r\n                str: this.csv.slice(s, e),\r\n                noData: NoDataTreat.ignore,\r\n                targetCellNum: cellNum\r\n            }\r\n            let w = this.getWorker();\r\n            w.onmessage = function (ev) {\r\n                resolve(<CalcResult>ev.data);\r\n                w.terminate();\r\n            };\r\n            w.postMessage(arg);\r\n        });\r\n    }\r\n    initWorker() {\r\n        this.workerPool = [];\r\n        for (let i = 0; i < this.workNum; i++) {\r\n            this.workerPool.push(new Worker(\"worker.js\"));\r\n        }\r\n    }\r\n    getWorker() {\r\n        this.workerIndex++;\r\n        if (this.workerIndex >= this.workNum) {\r\n            this.workerIndex = 0;\r\n        }\r\n        return this.workerPool[this.workerIndex];\r\n    }\r\n}\r\n\r\n/** 普通にfor文で計算するパティーン */\r\nexport function normalCalc(arg: CalcArg): CalcResult {\r\n    console.time(\"nParseTime\");\r\n    const parse = U.parseCSVKai(arg.csv[Symbol.iterator](), (v: string) => v, U.CSV_SEP, U.LINE_SEP, arg.targetCellNum);\r\n    console.timeEnd(\"nParseTime\");\r\n    let calcArr: number[] = [];\r\n    for (let i = 0, l = parse.targetArr.length; i < l; i++) {\r\n        calcArr.push(parseFloat((parse.targetArr[i]).replace(/^\\\"+|\\\"+$/g, \"\")))\r\n    }\r\n    return U.getAve(calcArr, parse.lineNum, arg.noData);\r\n}","import * as calc from \"./calc\";\r\nimport { NoDataTreat as NDT, CalcArg as CArg, CalcResult as CRslt } from \"./calc\";\r\n\r\ndeclare global {\r\n    interface Window { resultsForTable: Results; }\r\n}\r\n\r\nenum WorkType {\r\n    webworker,\r\n    normal\r\n}\r\n\r\nfunction getWTLavel(wt: WorkType): string {\r\n    switch (wt) {\r\n        case WorkType.normal:\r\n            return \"メインでfor文\";\r\n        case WorkType.webworker:\r\n            return \"WebWorker\";\r\n        default:\r\n            return \"おかしいので確認して！\";\r\n    }\r\n}\r\n\r\nconst TARGETCELLNUM = 11;\r\nconst THREADNUMS = [1, 4, 8, 16];\r\nconst RECORDNUMS = [50000, 100000, 200000];\r\nconst TESTNUM = 10;\r\nconst AVEKEY = 0;\r\n\r\nconst cg = document.getElementById(\"csvget\");\r\ncg.onclick = function () {\r\n    const a = new XMLHttpRequest();\r\n    const recordNum = parseInt((<HTMLSelectElement>document.getElementById(\"records-selector\")).value);\r\n    const threadNum = parseInt((<HTMLSelectElement>document.getElementById(\"threads-selector\")).value);\r\n    a.open(\"GET\", \"http://127.0.0.1:8000/bigfile/csv_\" + recordNum + \".csv\", true);\r\n    a.send();\r\n    a.onreadystatechange = function () {\r\n        if (a.readyState === XMLHttpRequest.DONE) {\r\n            doTest(a.responseText, 1, getWorkType(), recordNum, threadNum);\r\n        }\r\n    }.bind(recordNum, threadNum)\r\n}\r\n\r\nconst t10t = document.getElementById(\"test10time\");\r\nt10t.onclick = function () {\r\n    alert(\"⚠工事中⚠\");\r\n    // const a = new XMLHttpRequest();\r\n    // a.open(\"GET\", \"http://127.0.0.1:8000/bigfile/rice.csv\", true);\r\n    // a.send();\r\n    // a.onreadystatechange = function () {\r\n    //     if (a.readyState === XMLHttpRequest.DONE) {\r\n    //         doTest(a.responseText, 10);\r\n    //     }\r\n    // }\r\n}\r\n\r\nfunction doTest(csv: string, num: number, worktype: WorkType, recordNum: number, threadNum: number) {\r\n    for (let i = 0; i < num; i++) {\r\n        if (!isNaN(worktype)) {\r\n            requestCalc({ csv: csv, targetCellNum: TARGETCELLNUM, noData: NDT.ignore }, worktype, recordNum, threadNum);\r\n        } else {\r\n            alert(\"worktype invalid!: \" + worktype);\r\n        }\r\n    }\r\n}\r\n\r\n/** 画面のワークタイプ選択ラジオボタンからワークタイプを割り出す */\r\nfunction getWorkType(): WorkType {\r\n    const wr = <HTMLFormElement>document.getElementById(\"worktype-radio\");\r\n    return <WorkType>(parseInt(wr[\"worktype\"].value));\r\n}\r\n\r\nasync function requestCalc(arg: CArg, worktype: WorkType, recordNum: number, threadNum: number) {\r\n    let result: CRslt;\r\n    let time = Date.now();\r\n    switch (worktype) {\r\n        case WorkType.webworker:\r\n            const c = new calc.CsvCalc(arg.csv, arg.noData, threadNum);\r\n            result = await c.getAve(arg.targetCellNum);\r\n            break;\r\n        case WorkType.normal:\r\n            result = calc.normalCalc(arg);\r\n            break;\r\n        default:\r\n            alert(\"worktypeがおかしいんじゃ:\" + worktype);\r\n    }\r\n    time = Date.now() - time;\r\n    pushResult(result, time, recordNum, threadNum, worktype);\r\n    window.resultsForTable.drawOutput();\r\n}\r\n\r\nfunction pushResult(result: CRslt, ms: number, recordNum: number, threadNum: number, worktype: WorkType) {\r\n    if (!window.resultsForTable) {\r\n        window.resultsForTable = new Results();\r\n    }\r\n    window.resultsForTable.push({ result, ms }, worktype, recordNum, threadNum);\r\n}\r\n\r\nfunction initOutPutTable() {\r\n    const headers = [\"record\", \"thread\", \"type\", \"平均\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\"];\r\n    const table = document.createElement(\"table\");\r\n    const tr_header = document.createElement(\"tr\"); table.appendChild(tr_header);\r\n    for (let h of headers) {\r\n        const th = document.createElement(\"th\");\r\n        th.innerHTML = h;\r\n        tr_header.appendChild(th);\r\n    }\r\n    for (let RN of RECORDNUMS) {\r\n        let tr = document.createElement(\"tr\"); table.appendChild(tr);\r\n        const th_RN = document.createElement(\"th\"); tr.appendChild(th_RN);\r\n        /** レコード数が書かれるカラムの縦結合長 */\r\n        let RNRowCount = 0;\r\n        th_RN.innerHTML = RN.toString(); // レコード数が書いてあるカラム\r\n        let firstTN = true;\r\n        for (let TN of THREADNUMS) {\r\n            if (firstTN) {\r\n                firstTN = false;\r\n            } else {\r\n                tr = document.createElement(\"tr\"); table.appendChild(tr);\r\n            }\r\n            const th_TN = document.createElement(\"th\"); tr.appendChild(th_TN);\r\n            /** スレッド数が書かれるカラムの縦結合長 */\r\n            let TNRowCount = 0;\r\n            th_TN.innerHTML = TN.toString(); // スレッド数が書いてあるカラム\r\n            let firstWT = true;\r\n            for (let WT_STR in WorkType) {\r\n                const WT = parseInt(WT_STR);\r\n                if (!isNaN(WT)) {\r\n                    RNRowCount++;\r\n                    TNRowCount++;\r\n                    if (firstWT) {\r\n                        firstWT = false;\r\n                    } else {\r\n                        tr = document.createElement(\"tr\"); table.appendChild(tr);\r\n                    }\r\n                    const th_WT = document.createElement(\"th\"); tr.appendChild(th_WT);\r\n                    // 値を格納するときに辿れるようにidを付与する\r\n                    th_WT.innerHTML = getWTLavel(WT); // 仕事種別が書いてあるカラム\r\n                    // 平均値カラム\r\n                    const th_AVE = document.createElement(\"th\"); tr.appendChild(th_AVE);\r\n                    th_AVE.id = createColumnID(RN, TN, WT, AVEKEY); // アベレージは0カラムとする\r\n                    th_AVE.innerHTML = \"N/A\";\r\n                    for (let i = 1; i <= TESTNUM; i++) {\r\n                        // 1～10のID付与するので、0始まりじゃなくした。\r\n                        const result = document.createElement(\"td\"); tr.appendChild(result);\r\n                        // 値を格納するときに辿れるようにidを付与する\r\n                        result.id = createColumnID(RN, TN, WT, i);\r\n                        result.innerHTML = \"N/A\";\r\n                    }\r\n                }\r\n            }\r\n            th_TN.rowSpan = TNRowCount;\r\n        }\r\n        th_RN.rowSpan = RNRowCount;\r\n    }\r\n\r\n    const d = <HTMLDivElement>document.getElementById(\"calc-result\");\r\n    d.innerHTML = \"\";\r\n    d.appendChild(table);\r\n}\r\n\r\n/** ID生成。すごく雑に作ってあるがnumberが来たらtoStringしてくれるしいい感じに動くはず。 */\r\nfunction createColumnID(recordnum: number | string, threadnum: number | string, worktype: number | string, num: number | string): string {\r\n    return recordnum + \"_\" + threadnum + \"_\" + worktype + \"_\" + num;\r\n}\r\n\r\nclass Results {\r\n    result: { [recordnum: number]: { [threadnum: number]: { [worktype: number]: { result: CRslt, ms: number }[] } } };\r\n    constructor() {\r\n        this.result = {};\r\n        for (let rn of RECORDNUMS) {\r\n            this.result[rn] = {};\r\n            for (let tn of THREADNUMS) {\r\n                this.result[rn][tn] = {};\r\n                for (let v in WorkType) {\r\n                    const t = parseInt(v);\r\n                    if (!isNaN(t)) {\r\n                        this.result[rn][tn][t] = [];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        initOutPutTable();\r\n    }\r\n    push(result: { result: CRslt, ms: number }, worktype: WorkType, recordnum: number, threadnum: number) {\r\n        if (!this.result[recordnum] || !this.result[recordnum][threadnum] || !this.result[recordnum][threadnum][worktype]) {\r\n            alert(\"Results.pushできません。なにかがおかしいです。recordnum:\" + recordnum + \", threadnum:\" + threadnum + \", worktype:\" + worktype);\r\n        }\r\n        this.result[recordnum][threadnum][worktype].unshift(result);\r\n        if (this.result[recordnum][threadnum][worktype].length > TESTNUM) {\r\n            this.result[recordnum][threadnum][worktype] = this.result[recordnum][threadnum][worktype].slice(0, TESTNUM);\r\n        }\r\n    }\r\n    drawOutput() {\r\n        // こちらはキー値で拾っていくので、constructorと異なりfor...inである。\r\n        for (let rn in this.result) {\r\n            for (let tn in this.result[rn]) {\r\n                for (let wt in this.result[rn][tn]) {\r\n                    const val = this.result[rn][tn][wt];\r\n                    let sum = 0;\r\n                    for (let i = 0, l = val.length; i < l; i++) {\r\n                        // DOM探しの時、iを一つ増やすことだけ注意する。\r\n                        const column = document.getElementById(createColumnID(rn, tn, wt, i + 1));\r\n                        column.innerHTML = val[i].ms + \"\";\r\n                        sum += val[i].ms;\r\n                    }\r\n                    if (val.length > 0) {\r\n                        const ave = document.getElementById(createColumnID(rn, tn, wt, AVEKEY));\r\n                        ave.innerHTML = (sum / val.length) + \"ms\";\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nif (!window.resultsForTable) {\r\n    window.resultsForTable = new Results();\r\n}","import { NoDataTreat, CalcResult } from \"./calc\";\r\n\r\nexport namespace Utils {\r\n    export const CSV_SEP = \",\";\r\n    export const LINE_SEP = \"\\n\";\r\n    export const CSV_SEP_CODE = CSV_SEP.codePointAt(0);\r\n    export const LINE_SEP_CODE = LINE_SEP.codePointAt(0);\r\n    export const TRIM_STR_CODE = \"\\\"\".codePointAt(0);\r\n\r\n    /** CSVパーサ。ダブルクォートなどはまったく考慮していない。 */\r\n    export function parseCSV(arg: { csvArr: string[], calcArr: number[], currentCellStartI: number, i: number, cellNum: number, targetCellNum: number }): void {\r\n        switch (arg.csvArr[arg.i]) {\r\n            case CSV_SEP:\r\n            case LINE_SEP:\r\n                // セルの終わりなので、現在のセル確認\r\n                if (arg.cellNum === arg.targetCellNum) {\r\n                    // 現在ターゲットセルにいれば、中身を計算対象に入れる。数値じゃなきゃNaNを入れて、後処理で頑張ってもらう。\r\n                    arg.calcArr.push(parseFloat((arg.csvArr.slice(arg.currentCellStartI, arg.i).join(\"\")).replace(/^\\\"+|\\\"+$/g, \"\")));\r\n                }\r\n                arg.currentCellStartI = arg.i + 1; // 次の文字がセル開始位置\r\n                if (arg.csvArr[arg.i] === CSV_SEP) {\r\n                    // セル区切りなのでセル番を更新\r\n                    arg.cellNum++;\r\n                } else if (arg.csvArr[arg.i] === LINE_SEP) {\r\n                    // 行区切りなので、セル番をリセット\r\n                    arg.cellNum = 0;\r\n                }\r\n                break;\r\n            default:\r\n        }\r\n    }\r\n\r\n    interface ParseResult {\r\n        targetArr: string[];\r\n        lineNum: number;\r\n    }\r\n\r\n    /** \r\n     * CSVパーサ。イテレータを渡すことで型に縛られずにイテレートする。  \r\n     * 文字コードUTF-8, 改行LF(\\n), 禁則文字[\",\",\"\\n\"]\r\n     * @param ite 元CSVデータのイテレータ。stringでもTypedArrayでも、hoge[Symbol.iterator]()でイテレータは取得できる。\r\n     * @param tostr valueをstringに変換するfunction。TypedArrayで必要なはず。\r\n     * @param csvSep CSVのセパレータ。文字列戻したりしたくはないので、そのまま判別したいので。\r\n     * @param lineSep 行セパレータ。同上。\r\n     * @param targetCellNum 返却対象のセル番号。\r\n     */\r\n    export function parseCSVKai<T>(ite: IterableIterator<T>, tostr: (a: T) => string, csvSep: T, lineSep: T, targetCellNum: number): ParseResult {\r\n        let targetCellVal: string[] = [];\r\n        /** 空セルは配列に入らない（飛ばされる） */\r\n        let targetArr: string[] = [];\r\n        let currentCellNum = 0;\r\n        let lineNum = 1;\r\n        let lastChar: T;\r\n\r\n        for (let t = ite.next(); t && t.value; t = ite.next()) {\r\n            lastChar = t.value;\r\n            switch (lastChar) {\r\n                case csvSep:\r\n                    currentCellNum++;\r\n                    break;\r\n                case lineSep:\r\n                    currentCellNum = 0;\r\n                    lineNum++;\r\n                    break;\r\n                default:\r\n                // nothing to do\r\n            }\r\n            if (currentCellNum === targetCellNum) {\r\n                if (lastChar !== csvSep && lastChar !== lineSep) {\r\n                    // 当該セル内で、かつセパレータは邪魔なので除く\r\n                    targetCellVal.push(tostr(lastChar));\r\n                }\r\n            } else {\r\n                if (targetCellVal.length !== 0) {\r\n                    // 内容をpush\r\n                    targetArr.push(targetCellVal.join(\"\"));\r\n                    targetCellVal = [];\r\n                }\r\n            }\r\n        }\r\n        if (lastChar === lineSep) {\r\n            // 最後が改行なら、次の行はカウントしないので一歩下がっておく\r\n            lineNum--;\r\n        }\r\n        return { targetArr, lineNum };\r\n    }\r\n\r\n    export function getAve(calcArr: number[], lineNum: number, ndt: NoDataTreat): CalcResult {\r\n        let invalidData: number[] = [];\r\n        let sum = 0;\r\n        for (let i = 0, l = calcArr.length; i < l; i++) {\r\n            if (!isNaN(calcArr[i])) {\r\n                // 数値は普通に足す\r\n                sum += calcArr[i];\r\n            } else {\r\n                // データなし配列に添字を入れる\r\n                invalidData.push(i);\r\n            }\r\n        }\r\n        // Noデータを０扱いするかどうかで割り算を変える\r\n        const result = sum / (ndt === NoDataTreat.zero ? lineNum : calcArr.length - invalidData.length);\r\n        return { val: result, lineNum, noDataNum: lineNum - calcArr.length, invalidDataNum: invalidData.length };\r\n    }\r\n\r\n    export function margeAve(rs: CalcResult[], ndt: NoDataTreat): CalcResult {\r\n        let tmpresult: CalcResult = { lineNum: 0, val: 0, noDataNum: 0, invalidDataNum: 0 };\r\n        for (let i = 0, l = rs.length; i < l; i++) {\r\n            switch (ndt) {\r\n                case NoDataTreat.ignore:\r\n                    tmpresult.val += rs[i].val * (rs[i].lineNum - rs[i].noDataNum - rs[i].invalidDataNum);\r\n                    break;\r\n                case NoDataTreat.zero:\r\n                    tmpresult.val += rs[i].val * rs[i].lineNum;\r\n                    break;\r\n                default:\r\n            }\r\n            tmpresult.lineNum += rs[i].lineNum;\r\n            tmpresult.invalidDataNum += rs[i].invalidDataNum;\r\n            tmpresult.noDataNum += rs[i].noDataNum;\r\n        }\r\n        let result = tmpresult;\r\n        switch (ndt) {\r\n            case NoDataTreat.ignore:\r\n                result.val = result.val / (result.lineNum - result.noDataNum - result.invalidDataNum);\r\n                break;\r\n            case NoDataTreat.zero:\r\n                result.val = result.val / result.lineNum;\r\n                break;\r\n            default:\r\n        }\r\n        return result;\r\n    }\r\n}"],"sourceRoot":""}